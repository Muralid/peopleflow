{% extends "layout.html" %}
{% block title %}ContactPoint -  {{ kiosk.company }} {% endblock %}
{% block header %}
{{ kiosk.company }}
{% endblock %}
{% block content %}

<div id="info" class="hero-unit">
<div id="name" >

</div>
<div id="email"> </div>
</div>
<div id="error"> </div>
<div id="card"> </div>

  <form id="kiosk" action="{{ url_for('share', kiosk=kiosk.name) }}" method="POST">
    <input id="nfc_id" class="hidden" type="hidden" name="id" value="" />
    <input id="share" class="btn btn-primary hidden" type="submit" value="Share" />
  </form>

{% endblock %}
{% block footerscripts %}
<script type="text/javascript">

(function poll(){
   setTimeout(function(){
      $.getJSON("http://127.0.0.1:8008/card_id.json?callback=?", function(data){
        console.log(data)

        if (data['card_id']) {
          url = "/participant/"+data['card_id'];
          $('input#nfc_id').attr("value",data['card_id'] );
          // $('input#share').removeClass("hidden")
            
          $.getJSON(url, function(data){
            if(data["error"]){
              
          $('div#info').addClass("hidden");
          $('div#error').removeClass("hidden");
          $('div#error').html('<h2>Invalid Card</h2>');
          $('input#share').addClass("hidden");
            }
              else{
            $('div#error').addClass("hidden");
            $('div#info').removeClass("hidden");
            $('div#name').html('<h1>'+data['name']+'</h1>');
            $('div#email').html('<h2>'+data['email']+'</h2>');
            setTimeout( function() { $('form#kiosk').submit() }, 800);
            // $('form#kiosk').submit().delay(1200);
          };
          }

            );
        }
        else if(data['error']=="no_card") {
          $('#div#error').addClass("hidden");
          $('div#info').addClass("hidden");
          $('input#share').addClass("hidden");
          $('div#error').addClass("hidden");
          $('div#card').removeClass("hidden");
          $('div#card').html('<h2>Tap your card to share contact information</h2>');
             }  
        else{
          $('div#error').html('<h2>Check the reader</h2>');
        };

        poll();
        
      });
  }, 3000);
})();

</script>

{% endblock %}